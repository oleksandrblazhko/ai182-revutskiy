# V5.5 Запобігання десеріалізації

| # | Опис | L1 | L2 | L3 | CWE |
| 5.5.1 | Переконайтеся, що серіалізовані об’єкти використовують перевірки цілісності або зашифровані, щоб запобігти створенню ворожих об’єктів або підробці даних. (C5) | + | + | + | 502 |
| 5.5.2 | Переконайтеся, що програма правильно обмежує XML-аналізатори використовувати лише максимально обмежувальну конфігурацію та переконайтеся, що небезпечні функції, такі як розпізнавання зовнішніх об’єктів, вимкнено, щоб запобігти атакам XML eXternal Entity (XXE). | + | + | + | 611 |
| 5.5.3 | Переконайтеся, що десеріалізація ненадійних даних уникається або захищена як у спеціальному коді, так і в бібліотеках сторонніх розробників (таких як JSON, XML і аналізатори YAML). | + | + | + | 502 | 
| 5.5.4 | Переконайтеся, що під час синтаксичного аналізу JSON у веб-переглядачах або серверних модулях на основі JavaScript JSON.parse використовується для аналізу документа JSON. Не використовуйте eval() для аналізу JSON. | + | + | + | 95 |


# C5: Перевірка усіх введених даних

## Oпис
Перевірка вхідних даних — це техніка програмування, яка гарантує, що лише правильно відформатовані дані можуть входити до компонента програмної системи.
### Синтаксис і семантична валідність
Програма повинна перевірити, чи дані є як синтаксично, так і семантично дійсними (у такому порядку), перш ніж використовувати їх у будь-який спосіб (включно з відображенням їх назад для користувача).

Правильність синтаксису означає, що дані знаходяться в очікуваній формі. Наприклад, програма може дозволити користувачеві вибрати чотиризначний «ідентифікатор облікового запису» для виконання певної операції. Додаток має припустити, що користувач вводить корисне навантаження SQL-ін’єкції, і повинен перевірити, що дані, введені користувачем, містять рівно чотири цифри та складаються лише з чисел (на додаток до використання належної параметризації запиту).

Семантична валідність включає лише прийняття вхідних даних, які знаходяться в прийнятному діапазоні для даної функціональності програми та контексту. Наприклад, під час вибору діапазонів дат дата початку має передувати даті завершення.

### Дозволення внесення до списку проти заборони внесення до списку
Існує два загальні підходи до перевірки синтаксису введення, широко відомі як дозволені та заборонені списки:

- Скасування списку або перевірка списку заборони* намагаються перевірити, чи дані не містять «відомо поганого» вмісту. Наприклад, веб-програма може блокувати введення, яке містить точний текст <SCRIPT>, щоб запобігти XSS. Однак цього захисту можна уникнути за допомогою тегу сценарію в нижньому регістрі або тегу сценарію зі змішаним регістром.
- Перевірка дозволених списків або білих списків намагається перевірити, чи певні дані відповідають набору «відомо хороших» правил. Наприклад, правило перевірки білого списку для штату США буде 2-літерним кодом, який є лише одним із дійсних штатів США.

**Важливо** Під час створення безпечного програмного забезпечення рекомендованим мінімальним підходом є білий список. Скасування списків схильне до помилок, і його можна обійти за допомогою різних методів ухилення, і може бути небезпечним, якщо залежати від самого себе. Незважаючи на те, що заборони в списку часто можна уникнути, це часто може допомогти виявити очевидні атаки. Таким чином, у той час як білий список допомагає обмежити поверхню атаки, забезпечуючи правильну синтаксичну та семантичну валідність даних, заборонений список допомагає виявляти та потенційно зупиняти очевидні атаки.

### Перевірка на стороні клієнта та на стороні сервера
Перевірка введених даних має завжди виконуватися на стороні сервера для безпеки. Хоча перевірка на стороні клієнта може бути корисною як для функціональних цілей, так і для деяких цілей безпеки, часто її можна легко обійти. Це робить перевірку на стороні сервера ще важливішою для безпеки. Наприклад, перевірка JavaScript може попередити користувача про те, що певне поле має складатися з чисел, але серверна програма повинна перевірити, що надіслані дані складаються лише з чисел у відповідному числовому діапазоні для цієї функції.

### Проблеми перевірки серіалізованих даних
Деякі форми введення настільки складні, що перевірка може лише мінімально захистити програму. Наприклад, небезпечно десеріалізувати ненадійні дані або дані, якими може маніпулювати зловмисник. Єдиний безпечний архітектурний шаблон полягає в тому, щоб не приймати серіалізовані об’єкти з ненадійних джерел або лише десеріалізувати в обмеженій ємності лише для простих типів даних. Ви повинні уникати обробки серіалізованих форматів даних і використовувати легші для захисту формати, такі як JSON, коли це можливо.

Якщо це неможливо, розгляньте серію засобів захисту під час обробки серіалізованих даних.
- Реалізуйте перевірки цілісності або шифрування серіалізованих об’єктів, щоб запобігти створенню ворожих об’єктів або підробці даних.
- Застосування строгих обмежень типу під час десеріалізації перед створенням об’єкта; зазвичай код очікує визначеного набору класів. Були продемонстровані шляхи обходу цієї техніки.
- Ізолюйте код, який десеріалізується, щоб він запускався в середовищах з дуже низькими привілеями, наприклад у тимчасових контейнерах.
- Реєстрація винятків і помилок десеріалізації безпеки, наприклад, коли вхідний тип не є очікуваним типом або десеріалізація створює винятки.
- Обмежте або відстежуйте вхідне та вихідне підключення до мережі з контейнерів або серверів, які десеріалізуються.
- Відстежуйте десеріалізацію, сповіщаючи, якщо користувач постійно десеріалізується.

### Неочікуваний вхід користувача (масове призначення)

Деякі фреймворки підтримують автоматичне прив’язування параметрів запитів HTTP до об’єктів на стороні сервера, які використовуються програмою. Ця функція автоматичного прив’язування може дозволити зловмиснику оновлювати об’єкти на стороні сервера, які не призначені для модифікації. За допомогою цієї функції зловмисник може змінити свій рівень контролю доступу або обійти заплановану бізнес-логіку програми.

Ця атака має кілька назв, зокрема: масове призначення, автоматичне прив’язування та впровадження об’єктів.

Як простий приклад, якщо об’єкт користувача має поле привілеїв, яке визначає рівень привілеїв користувача в програмі, зловмисник може шукати сторінки, на яких змінено дані користувача, і додати привілей=admin до надісланих параметрів HTTP. Якщо автоматичне прив’язування ввімкнено незахищеним способом, об’єкт на стороні сервера, що представляє користувача, буде відповідно змінено.

Для цього можна використовувати два підходи:
- Уникайте безпосереднього зв’язування введених даних і замість цього використовуйте об’єкти передачі даних (DTO).
- Увімкніть автоматичне прив’язування, але встановіть правила білого списку для кожної сторінки чи функції, щоб визначити, які поля можна автоматично прив’язувати.

### Функціональність перевірки в бібліотеках і фреймворках
Усі мови та більшість фреймворків надають бібліотеки перевірки або функції, які слід використовувати для перевірки даних. Бібліотеки перевірки зазвичай охоплюють загальні типи даних, вимоги до довжини, діапазони цілих чисел, перевірки «є нулем» тощо. Багато бібліотек і фреймворків перевірки дозволяють визначити ваш власний регулярний вираз або логіку для спеціальної перевірки таким чином, щоб програміст міг використовувати ці функції у вашій програмі. Приклади функцій перевірки включають функції фільтрів PHP або Hibernate Validator для Java. Приклади дезінфікуючих засобів HTML включають метод очищення Ruby on Rails, OWASP Java HTML Sanitizer або DOMPurify.



# CWE-502: Десеріалізація ненадійних даних

## Опис
The application deserializes untrusted data without sufficiently verifying that the resulting data will be valid.

## Детальний опис 
Часто зручно серіалізувати об’єкти для зв’язку або зберегти їх для подальшого використання. Однак десеріалізовані дані або код часто можна змінити без використання наданих функцій доступу, якщо вони не використовують криптографію для захисту. Більше того, будь-яка криптографія все одно буде захистом на стороні клієнта, що є небезпечним припущенням безпеки.

Дані, яким не можна довіряти, не можна вважати правильними.

Коли розробники не накладають обмежень на «ланцюжки гаджетів» або серії екземплярів і викликів методів, які можуть самостійно виконуватися під час процесу десеріалізації (тобто до того, як об’єкт буде повернено абоненту), інколи зловмисники можуть використовувати їх для виконувати несанкціоновані дії, наприклад генерувати оболонку.

## Платформи, що застосовуються
Cписок показує можливі області, для яких може виникнути дана слабкість. Вони можуть стосуватися конкретних іменованих мов, операційних систем, архітектур, парадигм, технологій або класу таких платформ. Платформа вказана разом із частотою появи даного недоліку для цього екземпляра.

*Мови*
- Java (невизначена поширеність)
- Ruby (невизначена поширеність)
- PHP (невизначена поширеність)
- Python (невизначена поширеність)
- JavaScript (невизначена поширеність)
*Технології*
- Клас: ICS/OT (часто поширений)

## Загальні наслідки

| Область застосування | Вплив | Ймовірність |
| Цілісність | Технічний вплив: зміна даних програми; Неочікуваний стан Зловмисники можуть змінювати неочікувані об’єкти або дані, які вважалися безпечними для модифікації. | |
| Доступність | Технічний вплив: DoS: споживання ресурсів (ЦП)Якщо функція робить припущення про те, коли завершувати роботу, на основі сторожового в рядку, вона легко може ніколи не припинити роботу. | |
| Інше | Технічний вплив: залежить від контексту. Наслідки можуть сильно відрізнятися, оскільки це залежить від того, які об’єкти чи методи десеріалізуються та як вони використовуються. Припускати, що код десеріалізованого об’єкта дійсний, небезпечно та може стати причиною експлуатаці | |

## Ймовірність експлойту
Середня




